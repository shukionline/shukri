<!DOCTYPE html>
<html lang="so">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SHUKRI STORE - Dukaankaaga</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* ==== ŸÜŸÅÿ≥ CSS ÿßŸÑÿ≥ÿßÿ®ŸÇ ŸÖÿπ ÿ®ÿπÿ∂ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™ ==== */
    * { box-sizing: border-box; margin: 0; padding:0;}
    body { font-family:'Segoe UI', sans-serif; background:#f3f4f6;}
    header { background:#0f172a; color:white; text-align:center; font-size:28px; padding:20px; position:relative; box-shadow:0 4px 6px rgba(0,0,0,0.1);}
    #adminBtn {position:absolute; left:20px; top:20px; background:#475569; color:white; border:none; padding:8px 16px; border-radius:30px; cursor:pointer; font-size:14px;}
    #adminBtn:hover { background:#1e293b;}
    .search { text-align:center; margin:20px;}
    .search input {padding:12px 20px; width:90%; max-width:400px; border-radius:50px; border:1px solid #ccc; font-size:16px;}
    #cartBtn { position:fixed; top:20px; right:20px; background:#0284c7; color:white; border:none; padding:12px 18px; border-radius:50px; cursor:pointer; z-index:1000; font-size:18px;}
    #cartCount { background:#dc2626; border-radius:50%; padding:2px 7px; margin-left:5px; font-weight:bold;}
    .container { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:25px; padding:30px; max-width:1400px; margin:0 auto;}
    .card {background:white; padding:15px; border-radius:16px; text-align:center; box-shadow:0 6px 12px rgba(0,0,0,0.08);}
    .card img { width:100%; height:180px; object-fit:cover; border-radius:12px;}
    .card h3 { margin:15px 0 5px; font-size:1.2rem;}
    .price-container { margin:10px 0;}
    .original-price { text-decoration:line-through; color:#6b7280; margin-right:8px;}
    .final-price { color:#16a34a; font-weight:bold; font-size:22px;}
    .discount-badge { background:#ef4444; color:white; padding:4px 8px; border-radius:20px; font-size:12px;}
    .card button { background:#0284c7; color:white; border:none; padding:10px 25px; border-radius:30px; cursor:pointer; font-weight:600;}
    .card button:hover { background:#0369a1;}
    .admin-panel { position:fixed; top:80px; left:20px; background:white; padding:20px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.3); width:350px; max-height:80vh; overflow-y:auto; z-index:2000; display:none;}
    .cart { position:fixed; top:90px; right:20px; background:white; padding:20px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.2); width:300px; display:none; z-index:999; max-height:70vh; overflow-y:auto;}
    .whatsapp {background:#25D366; color:white; border:none; padding:12px; width:100%; border-radius:30px; font-weight:bold; cursor:pointer;}
  </style>
</head>
<body>

<header>
  üõçÔ∏è SHUKRI STORE
  <button id="adminBtn" onclick="promptPassword()">üîê Maamul</button>
</header>

<button onclick="toggleCart()" id="cartBtn">
  üõí Sareed <span id="cartCount">0</span>
</button>

<div class="search">
  <input type="text" id="search" placeholder="Raadi badeecad..." onkeyup="searchProduct()">
</div>

<div class="container" id="products"></div>

<!-- Admin panel -->
<div class="admin-panel" id="adminPanel">
  <h3>Maamulka alaabta <button onclick="toggleAdminPanel()">‚úñ</button></h3>
  <h4>Kudar alaab cusub</h4>
  <input type="text" id="prodName" placeholder="Magaca alaabta">
  <input type="number" id="prodPrice" placeholder="Qiimaha ($)">
  <input type="number" id="prodDiscount" placeholder="Dhimis % (Ikhtiyaar)" min="0" max="100">
  <input type="text" id="prodImage" placeholder="Linkiga sawirka">
  <button onclick="addProduct()">‚ûï Ku dar</button>
  <h4>Alaabta hadda jirta</h4>
  <div id="adminProductList"></div>
</div>

<div class="cart">
  <h3>üõí Sareedkaaga <button onclick="clearCart()">üóëÔ∏è Tirtir dhamaan</button></h3>
  <ul id="cartItems"></ul>
  <div class="total">Wadarta: $<span id="total">0</span></div>
  <button class="whatsapp" onclick="sendWhatsApp()">üì± Ku dalbo WhatsApp</button>
</div>

<script>
  // ======= Supabase setup =======
  const SUPABASE_URL = 'https://fmhfxtyyblqgvhakfwmz.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_nJAqs78euR6NRjyQPvxC7w_Ttf0WqnJ';
  const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // ======= State =======
  let products = [];
  let cart = [];
  let total = 0;

  // ======= Load products from Supabase =======
  async function loadProducts() {
    const { data, error } = await supabase.from('products').select('*').order('id', { ascending:true });
    if (error) { alert('Error loading products: '+error.message); return; }
    products = data || [];
    renderProducts();
  }

  // ======= Render products =======
  function renderProducts() {
    const container = document.getElementById('products');
    container.innerHTML = '';
    products.forEach(prod => {
      const finalPrice = prod.discount ? (prod.price - (prod.price * prod.discount / 100)).toFixed(2) : prod.price;
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${prod.image}" alt="${prod.name}">
        <h3>${prod.name}</h3>
        <div class="price-container">
          ${prod.discount ? `<span class="original-price">$${prod.price}</span>` : ''}
          <span class="final-price">$${finalPrice}</span>
        </div>
        ${prod.discount ? `<span class="discount-badge">-${prod.discount}%</span>` : ''}
        <button onclick="addToCart('${prod.name}', ${finalPrice})">üõí Ku dar</button>
      `;
      container.appendChild(card);
    });
    renderAdminProductList();
  }

  // ======= Admin panel =======
  async function renderAdminProductList() {
    const listDiv = document.getElementById('adminProductList');
    listDiv.innerHTML = '';
    products.forEach(prod => {
      const item = document.createElement('div');
      item.innerHTML = `
        <strong>${prod.name}</strong> - $${prod.price} ${prod.discount? `(-${prod.discount}%)`:''} 
        <button onclick="deleteProduct(${prod.id})">‚úñ</button>
      `;
      listDiv.appendChild(item);
    });
  }

  async function addProduct() {
    const name = document.getElementById('prodName').value.trim();
    const price = parseFloat(document.getElementById('prodPrice').value);
    const discount = parseFloat(document.getElementById('prodDiscount').value) || 0;
    const image = document.getElementById('prodImage').value.trim();
    if(!name || isNaN(price) || !image) { alert('Fadlan buuxi dhamaan beelaha loo baahan yahay'); return; }
    const { data, error } = await supabase.from('products').insert([{name, price, discount, image}]);
    if(error){ alert('Error: '+error.message); return;}
    document.getElementById('prodName').value='';
    document.getElementById('prodPrice').value='';
    document.getElementById('prodDiscount').value='';
    document.getElementById('prodImage').value='';
    loadProducts();
  }

  async function deleteProduct(id){
    const { data, error } = await supabase.from('products').delete().eq('id', id);
    if(error){ alert('Error: '+error.message); return; }
    loadProducts();
  }

  function promptPassword(){
    const password = prompt('Gali erayga sirta ah ee maamulka:');
    if(password==='Shukri@2026#Admin'){ document.getElementById('adminPanel').style.display='block';}
    else{ alert('Erayga sirta ah waa khalad');}
  }
  function toggleAdminPanel(){ const panel=document.getElementById('adminPanel'); panel.style.display = panel.style.display==='block'?'none':'block';}

  // ======= Cart =======
  function toggleCart(){ const cartBox=document.querySelector(".cart"); cartBox.style.display = cartBox.style.display==='block'?'none':'block';}
  function addToCart(name, price){ cart.push({name,price}); total+=price; updateCart(); alert(`‚úÖ ${name} waxaa lagu daray sareedka`);}
  function removeItem(i){ total-=cart[i].price; cart.splice(i,1); updateCart();}
  function clearCart(){ cart=[]; total=0; updateCart();}
  function updateCart(){
    const list=document.getElementById("cartItems"); list.innerHTML='';
    cart.forEach((item,i)=>{const li=document.createElement('li'); li.innerHTML=`${item.name} - $${item.price} <button onclick="removeItem(${i})">‚úñ</button>`; list.appendChild(li);});
    document.getElementById("total").textContent=total;
    document.getElementById("cartCount").textContent=cart.length;
  }
  function sendWhatsApp(){
    if(cart.length===0){alert('Sareedku waa madhan!'); return;}
    let message="*Dalabkayga cusub:*%0A"; cart.forEach(item=>{message+=`‚Ä¢ ${item.name} - $${item.price}%0A`;});
    message+=`----------------%0A*Wadarta: $${total}*`;
    window.open("https://wa.me/252614837293?text="+message);
  }

  // ======= Search =======
  function searchProduct(){
    const input=document.getElementById('search').value.toLowerCase();
    document.querySelectorAll('.card').forEach(card=>{
      const text=card.innerText.toLowerCase();
      card.style.display = text.includes(input)? 'block':'none';
    });
  }

  loadProducts();
</script>
</body>
</html>